<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>架空言語辞書アプリ</title>
    <style>
        body {
            font-family: "Maru Gothic", sans-serif;
        }
        .dictionary-entry {
            border: 1px solid #009999;
            background-color: #00BBBB;
            margin: 10px;
            padding: 10px;
        }
        .dictionary-entry h3 {
            font-family: "Maru Gothic", sans-serif;
        }
        .example {
            border: 1px solid #009999;
            background-color: #00BBBB;
            padding: 5px;
            margin-top: 5px;
        }
        button {
            background-color: #00aa00;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>架空言語辞書アプリ</h1>
    <p id="currentDictionary">現在の辞書: <span id="dictionaryName"></span></p>
    <p>単語数: <span id="wordCount"></span></p>
    <p>ページ: <span id="currentPage"></span></p>
    
    <input type="file" id="fontUpload" accept=".ttf,.otf,.woff">
    <input type="file" id="otmJsonUpload" accept=".json">
    <button onclick="uploadFont()">フォントアップロード</button>
    <button onclick="uploadOtmJson()">OTM JSONアップロード</button>

    <h2>単語追加</h2>
    <form id="addWordForm">
        <label for="word">単語:</label>
        <input type="text" id="word" required><br>
        <label for="definition">定義:</label>
        <input type="text" id="definition" required><br>
        <label for="examples">例文:</label>
        <input type="text" id="examples"><br>
        <label for="pronunciation">発音:</label>
        <input type="text" id="pronunciation"><br>
        <label for="tags">タグ:</label>
        <input type="text" id="tags"><br>
        <label for="pos">品詞:</label>
        <input type="text" id="pos"><br>
        <label for="relatedWords">関連語:</label>
        <input type="text" id="relatedWords"><br>
        <button type="button" onclick="addWord()">追加</button>
    </form>
    
    <h2>検索</h2>
    <input type="text" id="searchInput">
    <button onclick="searchWords('complete')">完全一致検索</button>
    <button onclick="searchWords('prefix')">前方一致検索</button>
    <button onclick="searchWords('partial')">部分一致検索</button>

    <div id="dictionaryEntries"></div>
    
    <button onclick="prevPage()">戻る</button>
    <button onclick="nextPage()">進む</button>

    <script>
        let dictionary = [];
        let currentPage = 1;
        const entriesPerPage = 20;

        function uploadFont() {
            const fileInput = document.getElementById('fontUpload');
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const fontFace = new FontFace('UploadedFont', e.target.result);
                document.fonts.add(fontFace);
                fontFace.load().then(() => {
                    document.body.style.fontFamily = 'UploadedFont, sans-serif';
                });
            };
            reader.readAsArrayBuffer(file);
        }

        function uploadOtmJson() {
            const fileInput = document.getElementById('otmJsonUpload');
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = JSON.parse(e.target.result);
                dictionary = data.words;
                displayDictionary();
            };
            reader.readAsText(file);
        }

        function addWord() {
            const word = document.getElementById('word').value;
            const definition = document.getElementById('definition').value;
            const examples = document.getElementById('examples').value.split(',');
            const pronunciation = document.getElementById('pronunciation').value;
            const tags = document.getElementById('tags').value.split(',');
            const pos = document.getElementById('pos').value;
            const relatedWords = document.getElementById('relatedWords').value.split(',').map(word => ({ form: word.trim(), id: generateId() }));

            const newEntry = {
                entry: {
                    id: generateId(),
                    form: word
                },
                translations: [{ title: "definition", forms: [definition] }],
                tags,
                contents: [{ title: pos, text: definition }],
                variations: [],
                relations: relatedWords.map(word => ({ title: "related", entry: word }))
            };
            dictionary.push(newEntry);
            displayDictionary();
        }

        function searchWords(type) {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            let filteredDictionary = [];

            switch (type) {
                case 'complete':
                    filteredDictionary = dictionary.filter(entry => entry.entry.form.toLowerCase() === searchInput);
                    break;
                case 'prefix':
                    filteredDictionary = dictionary.filter(entry => entry.entry.form.toLowerCase().startsWith(searchInput));
                    break;
                case 'partial':
                    filteredDictionary = dictionary.filter(entry => entry.entry.form.toLowerCase().includes(searchInput));
                    break;
            }
            displayDictionary(filteredDictionary);
        }

        function displayDictionary(filteredDictionary = dictionary) {
            const dictionaryEntries = document.getElementById('dictionaryEntries');
            dictionaryEntries.innerHTML = '';
            const startIndex = (currentPage - 1) * entriesPerPage;
            const endIndex = startIndex + entriesPerPage;
            const currentEntries = filteredDictionary.slice(startIndex, endIndex);

            currentEntries.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'dictionary-entry';
                entryDiv.innerHTML = `
                    <h3>${entry.entry.form}</h3>
                    <p>${entry.translations.map(t => t.forms.join(', ')).join('; ')}</p>
                    <p>発音: ${entry.pronunciation || ''}</p>
                    <p>タグ: ${entry.tags.join(', ')}</p>
                    <p>品詞: ${entry.contents.map(c => c.title).join(', ')}</p>
                    <div class="example">
                        <p>例文:</p>
                        ${entry.examples.map(example => `<p>${example}</p>`).join('')}
                    </div>
                `;
                dictionaryEntries.appendChild(entryDiv);
            });

            document.getElementById('wordCount').innerText = filteredDictionary.length;
            document.getElementById('currentPage').innerText = currentPage;
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                displayDictionary();
            }
        }

        function nextPage() {
            if (currentPage * entriesPerPage < dictionary.length) {
                currentPage++;
                displayDictionary();
            }
        }

        function generateId() {
            return Math.floor(Math.random() * 1000000);
        }

        function saveDictionary() {
            const data = {
                words: dictionary,
                version: 2,
                settings: {
                    zpdic: {
                        punctuationTitle: "punctuations",
                        pronunciationTitle: "発音"
                    },
                    zpdicOnline: {
                        explanation: "これは架空言語の辞書です。",
                        enableMarkdown: false
                    }
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dictionary.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function generateAccount() {
            const id = generateId();
            const password = Math.random().toString(36).slice(-8);
            alert(`アカウントID: ${id}\nパスワード: ${password}`);
        }

        // 初期表示
        displayDictionary();
        generateAccount();
    </script>
</body>
</html>
